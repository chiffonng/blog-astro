---
import type { MarkdownHeading } from 'astro'

import type { SiteMeta } from '@/types/site-config'
import PageLayout from '@/layouts/BaseLayout.astro'
import { BackToTop, Link, SlideOut } from '@/components'

interface Props {
  meta: SiteMeta
  highlightColor?: string
  back?: string
  headings?: MarkdownHeading[]
}

const { meta, highlightColor, back = '/', headings, ...props } = Astro.props
const hasTOC = headings && headings.length > 0
---

<PageLayout {meta} {highlightColor} {...props}>
  <Link title='Back' href={back} style='back' />
  <main class='mt-6 items-start gap-x-10 md:flex'>
    {/* Desktop Sidebar */}
    <aside
      class='animate top-20 min-w-48 basis-60 overflow-y-auto max-md:hidden z-40 fixed md:sticky md:order-2 lg:shrink-0 h-[50vh]'
      id='sidebar'
    >
      <slot name='sidebar' />
    </aside>

    <article class='min-w-0 grow'>
      {/* Content header */}
      <div id='content-header' class='animate'>
        <slot name='header' />
      </div>

      {/* Content */}
      <div id='content' class:list={['max-w-none animate mt-8 overflow-x-hidden prose']}>
        <slot />
      </div>
    </article>
  </main>

  <div class='bottom mt-6 items-start gap-x-10 md:flex'>
    {/* Bottom */}
    <div class='mt-8 flex-1 text-muted-foreground'>
      <slot name='bottom' />
    </div>
    <div class='min-w-48 basis-60'>
      <slot name='bottom-sidebar' />
    </div>
  </div>

  <BackToTop header='content-header' content='content'>
    {
      hasTOC && (
        <button
          slot='other-icons'
          aria-label='Toggle table of contents'
          class='size-10 flex items-center justify-center rounded-full border-2 bg-muted text-muted-foreground duration-300 hover:border-border/75 md:hidden sm:size-12'
          data-panel-trigger='mobile-toc'
        >
          <span class='i-mingcute:list-check-line' />
        </button>
      )
    }
  </BackToTop>

  {/* Mobile TOC SlideOut */}
  {
    hasTOC && (
      <SlideOut id='mobile-toc' title='Table of Contents' side='right' class='md:hidden'>
        <slot name='mobile-sidebar' />
      </SlideOut>
    )
  }
</PageLayout>
